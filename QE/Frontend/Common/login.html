<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Connexion - Qwota</title>
  
  <!-- üì± PWA Meta Tags -->
  <meta name="theme-color" content="#5271ff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Qwota">
  <meta name="msapplication-TileColor" content="#5271ff">

  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.webmanifest">

  <!-- Ic√¥nes PWA -->
  <link rel="icon" type="image/png" sizes="192x192" href="/static/icons/icon-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/static/icons/icon-512x512.png">
  <link rel="apple-touch-icon" href="/static/icons/icon-192x192.png">

  <!-- D√©senregistrer Service Workers obsol√®tes (localStorage conserv√© pour "Se souvenir de moi") -->
  <script>
  (function() {
    'use strict';

    // D√©senregistrer les Service Workers existants (pour √©viter probl√®mes de cache)
    if ('serviceWorker' in navigator && navigator.serviceWorker && navigator.serviceWorker.getRegistrations) {
      navigator.serviceWorker.getRegistrations().then(function(registrations) {
        for(let registration of registrations) {
          registration.unregister();
          console.log('[SW] Service Worker d√©senregistr√©:', registration.scope);
        }
      }).catch(function(e) {
        console.warn('[SW] Erreur d√©senregistrement:', e);
      });
    }

    console.log('[LOGIN] Page de connexion pr√™te - localStorage actif pour "Se souvenir de moi"');
  })();
  </script>

  <!-- üì± Blocage Mobile D√âSACTIV√â - App maintenant responsive -->
  <!-- <script>
  (function() {
    function isMobileDevice() {
      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }

    function isQwotaPage() {
      const path = window.location.pathname;
      return path.includes('/QWOTA/') || path.includes('/mobile-blocked');
    }

    if (isMobileDevice() && !isQwotaPage()) {
      console.log('üì± Mobile d√©tect√© - Redirection vers page de d√©veloppement');
      window.location.replace('/mobile-blocked');
    }
  })();
  </script> -->

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="icon" href="/favicon" type="image/x-icon">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
  
  <style>
:root {
  --primary-blue: #60a5fa;
  --primary-green: #34d399;
  --primary-red: #f87171;
  --primary-orange: #fb923c;
  --primary-purple: #a78bfa;
  --primary-indigo: #818cf8;
  --primary-pink: #f472b6;
  --primary-teal: #2dd4bf;
  --bg-dark: #0f172a;
  --bg-card: #1e293b;
  --text-light: #f1f5f9;
  --text-gray: #94a3b8;
  --border-dark: #334155;
  --shadow-dark: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
  --shadow-dark-medium: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
  --shadow-dark-strong: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
  --shadow-dark-soft: 0 1px 3px rgba(0, 0, 0, 0.4), 0 1px 2px rgba(0, 0, 0, 0.2);
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
  color: var(--text-light);
  min-height: 100vh;
  margin: 0;
  padding: 0;
}

/* Modern Buttons */
.btn-primary {
  background: linear-gradient(135deg, var(--primary-blue) 0%, #3b82f6 100%) !important;
  color: white !important;
  border-radius: 28px !important;
  font-weight: 700 !important;
  padding: 12px 32px !important;
  box-shadow: var(--shadow-dark-medium);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  position: relative;
  overflow: hidden;
  border: none;
  text-decoration: none;
  font-size: 1rem;
  cursor: pointer;
}

.btn-primary:hover {
  transform: translateY(-2px) scale(1.02);
  box-shadow: var(--shadow-dark-strong);
  background: linear-gradient(135deg, #3b82f6 0%, var(--primary-blue) 100%) !important;
}

.btn-secondary {
  background: linear-gradient(145deg, rgba(30, 41, 59, 0.9), rgba(51, 65, 85, 0.8)) !important;
  backdrop-filter: blur(10px);
  color: var(--text-light) !important;
  border: 2px solid rgba(96, 165, 250, 0.2) !important;
  border-radius: 28px !important;
  font-weight: 600 !important;
  padding: 12px 32px !important;
  box-shadow: var(--shadow-dark);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  text-decoration: none;
  font-size: 1rem;
  cursor: pointer;
}

.btn-secondary:hover {
  transform: translateY(-2px) scale(1.02);
  border-color: var(--primary-blue) !important;
  box-shadow: var(--shadow-dark-medium);
  background: linear-gradient(145deg, rgba(51, 65, 85, 0.95), rgba(71, 85, 105, 0.9)) !important;
}

/* Login Container */
.login-container {
  display: flex;
  min-height: 100vh;
  position: relative;
}

.login-hero {
  flex: 1;
  background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
  position: relative;
  overflow: hidden;
}

.login-hero-background {
  position: absolute;
  inset: 0;
  background: 
    radial-gradient(circle at 20% 80%, rgba(96, 165, 250, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgb(52 136 211 / 10%) 0%, transparent 50%);
}

.login-hero-content {
  position: relative;
  z-index: 2;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: flex-start;
  height: 100%;
  padding-left: 10rem;
  width: 100%;
}

.login-form-section {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 2rem;
  background: rgba(30, 41, 59, 0.3);
  backdrop-filter: blur(10px);
}

.login-form-container {
  background: linear-gradient(145deg, rgba(30, 41, 59, 0.95), rgba(51, 65, 85, 0.9));
  backdrop-filter: blur(20px);
  border: 1px solid rgba(71, 85, 105, 0.3);
  border-radius: 24px;
  padding: 3rem;
  box-shadow: var(--shadow-dark-strong);
  width: 100%;
  max-width: 450px;
  position: relative;
  overflow: hidden;
}

.login-form-container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(135deg, var(--primary-blue) 0%, #3b82f6 100%);
  border-radius: 24px 24px 0 0;
}

/* Form Styling */
.form-group {
  margin-bottom: 1.5rem;
}

.form-label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 600;
  color: var(--text-light);
  font-size: 0.875rem;
}

.form-input {
  width: 100%;
  padding: 12px 16px;
  background: rgba(15, 23, 42, 0.8) !important;
  border: 2px solid var(--border-dark) !important;
  border-radius: 12px !important;
  color: var(--text-light) !important;
  font-size: 0.875rem;
  transition: all 0.3s ease;
}

.form-input:focus {
  outline: none !important;
  border-color: var(--primary-blue) !important;
  box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.1) !important;
}

.form-input::placeholder {
  color: var(--text-gray) !important;
}

/* Checkbox Styling */
.checkbox-container {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 1.5rem;
}

.custom-checkbox {
  position: relative;
  display: flex;
  align-items: center;
  cursor: pointer;
}

.custom-checkbox input {
  opacity: 0;
  position: absolute;
}

.checkbox-box {
  width: 20px;
  height: 20px;
  border: 2px solid var(--border-dark);
  border-radius: 4px;
  background: rgba(15, 23, 42, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

.custom-checkbox:hover .checkbox-box {
  border-color: var(--primary-blue);
}

.custom-checkbox input:checked + .checkbox-box {
  background: var(--primary-blue);
  border-color: var(--primary-blue);
}

.checkbox-check {
  color: white;
  font-size: 0.75rem;
  opacity: 0;
  transition: opacity 0.2s ease;
}

.custom-checkbox input:checked + .checkbox-box .checkbox-check {
  opacity: 1;
}

.checkbox-label {
  font-size: 0.875rem;
  color: var(--text-gray);
  cursor: pointer;
}

/* Hero Title */
.hero-title {
  font-size: clamp(2rem, 4vw, 3rem);
  font-weight: 900;
  line-height: 1.1;
  margin-bottom: 1.5rem;
  background: linear-gradient(135deg, #60a5fa 0%, #ffffff 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.hero-subtitle {
  font-size: 1.125rem;
  color: var(--text-gray);
  margin-bottom: 2rem;
  font-weight: 400;
  line-height: 1.6;
}

/* Loading Button */
.btn-loading {
  position: relative;
  overflow: hidden;
}

.btn-loading.loading {
  color: transparent !important;
}

.loading-spinner {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 20px;
  height: 20px;
  border: 2px solid transparent;
  border-top: 2px solid white;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: translate(-50%, -50%) rotate(0deg); }
  100% { transform: translate(-50%, -50%) rotate(360deg); }
}

/* Error Message */
.error-message {
  color: var(--primary-red);
  font-size: 0.875rem;
  margin-top: 0.5rem;
  text-align: center;
}

/* Back Link */
.back-link {
  color: var(--text-gray);
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.875rem;
  margin-bottom: 2rem;
  transition: color 0.2s ease;
}

.back-link:hover {
  color: var(--primary-blue);
}

/* Logo */
.logo-image {
  height: 60px;
  width: auto;
  margin-bottom: 2rem;
  transition: all 0.3s ease;
  filter: drop-shadow(0 2px 8px rgba(96, 165, 250, 0.3));
}

.logo-image:hover {
  transform: scale(1.05);
  filter: drop-shadow(0 4px 12px rgba(96, 165, 250, 0.4));
}

/* Mobile Responsive */
@media (max-width: 768px) {
  .login-container {
    flex-direction: column;
  }
  
  .login-hero {
    min-height: 40vh;
  }
  
  .login-hero-content {
    padding: 2rem;
    text-align: center;
    align-items: center;
  }
  
  .login-form-section {
    min-height: 60vh;
    padding: 1rem;
  }
  
  .login-form-container {
    padding: 2rem;
    margin: 0;
  }
  
  .hero-title {
    font-size: 2rem;
  }
  
  .hero-subtitle {
    font-size: 1rem;
    text-align: center;
  }
}

/* Am√©liorations responsives suppl√©mentaires pour mobile */
@media (max-width: 480px) {
  /* Container principal mobile */
  .login-container {
    min-height: 100vh;
  }
  
  /* Hero section mobile */
  .login-hero {
    min-height: 35vh;
    padding: 1rem;
  }
  
  .login-hero-content {
    padding: 1.5rem;
    gap: 1rem;
  }
  
  .hero-title {
    font-size: 1.75rem;
    line-height: 1.1;
    margin-bottom: 0.75rem;
  }
  
  .hero-subtitle {
    font-size: 0.95rem;
    line-height: 1.5;
  }
  
  /* Form section mobile */
  .login-form-section {
    min-height: 65vh;
    padding: 0.75rem;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .login-form-container {
    padding: 1.5rem;
    margin: 0;
    width: 100%;
    max-width: 400px;
  }
  
  .form-title {
    font-size: 1.5rem;
    margin-bottom: 0.75rem;
    text-align: center;
  }
  
  .form-subtitle {
    font-size: 0.9rem;
    margin-bottom: 2rem;
    text-align: center;
  }
  
  /* Form fields mobile */
  .form-group {
    margin-bottom: 1.25rem;
  }
  
  .form-label {
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
  }
  
  .form-input {
    padding: 14px 16px;
    font-size: 1rem;
    border-radius: 8px;
  }
  
  .form-input:focus {
    outline: none;
    ring: 2px solid var(--primary-blue);
  }
  
  /* Buttons mobile */
  .btn-primary {
    width: 100%;
    padding: 14px 20px;
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
  }
  
  .forgot-password-link {
    font-size: 0.9rem;
    text-align: center;
    display: block;
    margin-bottom: 1.5rem;
  }
  
  .signup-link {
    font-size: 0.9rem;
    text-align: center;
  }
  
  /* Support link mobile */
  .support-link {
    font-size: 0.85rem;
    margin-top: 2rem;
    text-align: center;
    display: block;
  }
  
  /* Logo mobile */
  .logo-image {
    max-height: 40px;
  }
}

/* Am√©liorations pour tr√®s petits √©crans */
@media (max-width: 360px) {
  .login-hero {
    min-height: 30vh;
    padding: 0.75rem;
  }
  
  .login-hero-content {
    padding: 1rem;
  }
  
  .hero-title {
    font-size: 1.5rem;
  }
  
  .hero-subtitle {
    font-size: 0.9rem;
  }
  
  .login-form-section {
    padding: 0.5rem;
  }
  
  .login-form-container {
    padding: 1.25rem;
    max-width: 320px;
  }
  
  .form-title {
    font-size: 1.375rem;
  }
  
  .form-input {
    padding: 12px 14px;
    font-size: 0.95rem;
  }
  
  .btn-primary {
    padding: 12px 18px;
    font-size: 0.95rem;
  }
}

/* Am√©lioration du touch pour login */
@media (hover: none) and (pointer: coarse) {
  .form-input, .btn-primary {
    min-height: 44px;
  }
  
  .btn-primary:active {
    transform: scale(0.98);
    transition: transform 0.1s ease;
  }
  
  .forgot-password-link:active,
  .signup-link a:active,
  .support-link:active {
    opacity: 0.7;
    transition: opacity 0.1s ease;
  }
}

/* Am√©lioration pour le mode paysage mobile */
@media (max-width: 768px) and (orientation: landscape) {
  .login-container {
    flex-direction: row;
  }
  
  .login-hero {
    min-height: 100vh;
    width: 40%;
  }
  
  .login-form-section {
    min-height: 100vh;
    width: 60%;
  }
  
  .login-form-container {
    padding: 1.5rem;
    max-width: 350px;
  }
  
  .hero-title {
    font-size: 1.5rem;
  }
  
  .hero-subtitle {
    font-size: 0.9rem;
  }
}

/* Support Link */
.support-link {
  color: var(--text-gray);
  text-decoration: none;
  font-size: 0.875rem;
  transition: color 0.2s ease;
}

.support-link:hover {
  color: var(--primary-blue);
  text-decoration: underline;
}
</style>
</head>

<body>
  <div class="login-container">
    <!-- Hero Section -->
    <div class="login-hero">
      <div class="login-hero-background"></div>
      <div class="login-hero-content">
        <a href="/" class="back-link">
          <i class="fas fa-arrow-left"></i>
          Retour √† l'accueil
        </a>
        
        <img src="https://i.ibb.co/bgffVNDX/Sans-titre-500-x-170-px-9.png" alt="Qwota Logo" class="logo-image">
        
        <h1 class="hero-title">
          Connectez-vous √†<br>
          votre plateforme
        </h1>
        
        <p class="hero-subtitle">
          Acc√©dez √† vos outils de gestion professionnelle :<br>
          soumissions, factures, GQP et plus encore.
        </p>
        
        <div class="flex flex-col sm:flex-row gap-3">
          <a href="mailto:info@qwota.ca" class="btn-secondary">
            <i class="fas fa-envelope"></i>
            Nous contacter
          </a>
        </div>
      </div>
    </div>

    <!-- Form Section -->
    <div class="login-form-section">
      <div class="login-form-container">
        <div class="text-center mb-8">
          <h2 class="text-2xl font-bold text-light mb-2" style="color: var(--text-light);">Connexion</h2>
          <p class="text-gray" style="color: var(--text-gray);">Acc√©dez √† votre espace personnel</p>
        </div>

        <form id="loginForm" class="space-y-6">
          <!-- Username Field -->
          <div class="form-group">
            <label for="username" class="form-label">
              <i class="fas fa-user mr-2"></i>
              Nom d'utilisateur
            </label>
            <input
              type="text"
              id="username"
              name="username"
              placeholder="Votre nom d'utilisateur"
              class="form-input"
              required
              autocomplete="username"
            />
          </div>

          <!-- Password Field -->
          <div class="form-group">
            <label for="password" class="form-label">
              <i class="fas fa-lock mr-2"></i>
              Mot de passe
            </label>
            <input
              type="password"
              id="password"
              name="password"
              placeholder="Votre mot de passe"
              class="form-input"
              required
              autocomplete="current-password"
            />
          </div>

          <!-- Remember Me Checkbox -->
          <div class="checkbox-container">
            <label class="custom-checkbox">
              <input type="checkbox" id="rememberMe" name="rememberMe">
              <div class="checkbox-box">
                <i class="fas fa-check checkbox-check"></i>
              </div>
            </label>
            <span class="checkbox-label">Se souvenir de moi</span>
          </div>

          <!-- Login Button -->
          <button
            type="submit"
            id="loginButton"
            class="btn-primary w-full justify-center btn-loading"
            style="width: 100%; justify-content: center;"
          >
            <span id="btnText">Se connecter</span>
            <span id="btnSpinner" class="loading-spinner hidden"></span>
          </button>

          <!-- Error Message -->
          <p id="message" class="error-message min-h-[1.25rem]"></p>
        </form>
        
        <!-- Support Info -->
        <div class="mt-8 text-center">
          <p class="text-sm" style="color: var(--text-gray);">
            Besoin d'aide ? 
            <a href="mailto:support@qwota.ca" class="support-link">
              Contactez le support
            </a>
          </p>
        </div>
      </div>
    </div>
  </div>

<script>
// Attendre que le DOM soit compl√®tement charg√©
document.addEventListener('DOMContentLoaded', () => {
  // Petite pause pour s'assurer que tout est charg√©
  setTimeout(() => {
    initializeLoginPage();
  }, 100);
});

// Fonction de connexion r√©utilisable
async function performLogin(username, password, rememberMe) {
  const btnText = document.getElementById("btnText");
  const btnSpinner = document.getElementById("btnSpinner");
  const loginButton = document.getElementById("loginButton");
  const message = document.getElementById("message");

  if (!username || !password) {
    message.textContent = "Veuillez remplir tous les champs.";
    return;
  }

  // Show loading state
  loginButton.classList.add("loading");
  btnText.style.opacity = "0";
  btnSpinner.classList.remove("hidden");
  message.textContent = "";

  try {
    const res = await fetch("/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username, password }),
    });

    const data = await res.json();

    if (res.ok) {
      // Nettoyer compl√®tement le localStorage avant de sauvegarder les nouvelles infos
      localStorage.clear();

      localStorage.setItem("username", username);
      localStorage.setItem("userRole", data.role);

      // IMPORTANT: Mettre √† jour window.username imm√©diatement pour les scripts d√©j√† charg√©s
      window.username = username;

      // BLOCAGE MOBILE POUR DIRECTION (coach a acc√®s mobile)
      if (data.role === "direction") {
        const isSmallScreen = window.innerWidth <= 768;
        const mobileUA = /Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const isTablet = /iPad/i.test(navigator.userAgent) || (window.innerWidth > 768);

        if (isSmallScreen && mobileUA && !isTablet) {
          // Bloquer l'acc√®s mobile pour coach/direction
          document.body.innerHTML = `
            <div style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:linear-gradient(135deg,#0f172a 0%,#1e293b 100%);display:flex;justify-content:center;align-items:center;flex-direction:column;gap:1.5rem;text-align:center;padding:2rem;color:#f1f5f9;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;">
              <i class="fas fa-desktop" style="font-size:5rem;color:#60a5fa;"></i>
              <div style="font-size:1.5rem;font-weight:700;max-width:300px;line-height:1.4;">Application disponible uniquement sur PC</div>
              <div style="font-size:1rem;color:#94a3b8;max-width:280px;">L'acc√®s Coach et Direction n√©cessite un ordinateur</div>
            </div>
          `;
          return; // Arr√™ter ici, pas de redirection
        }
      }

      // Sauvegarder les donn√©es si "Se souvenir de moi" est coch√©
      if (rememberMe) {
        localStorage.setItem('qwotaCredentials', JSON.stringify({
          username,
          password,
          rememberMe: true
        }));
      } else {
        // Supprimer les donn√©es sauvegard√©es si la case n'est pas coch√©e
        localStorage.removeItem('qwotaCredentials');
      }

      // V√©rifier d'abord si l'utilisateur a compl√©t√© l'onboarding (seulement pour entrepreneurs)
      if (data.role === "entrepreneur") {
        // V√©rifier le statut de l'onboarding
        const onboardingCheck = await fetch(`/api/check-onboarding/${username}`);
        const onboardingData = await onboardingCheck.json();

        if (!onboardingData.completed) {
          // Premi√®re connexion - rediriger vers onboarding
          window.location.href = `/onboarding?user=${encodeURIComponent(username)}`;
          return;
        }

        // Onboarding compl√©t√© - redirection vers apppc (responsive mobile et desktop)
        // Passer le username en param√®tre pour garantir qu'il soit disponible imm√©diatement
        window.location.href = `/apppc?user=${encodeURIComponent(username)}`; // Application SPA responsive pour mobile et PC
      } else if (data.role === "coach") {
        window.location.href = `/apppccoach?user=${encodeURIComponent(username)}`;
      } else if (data.role === "direction") {
        window.location.href = `/apppcdirection?user=${encodeURIComponent(username)}`; // Rediriger direction vers interface admin
      } else if (data.role === "support") {
        window.location.href = `/support-admin?user=${encodeURIComponent(username)}`; // Rediriger support vers admin support
      } else {
        message.textContent = "R√¥le inconnu: " + data.role;
      }
    } else {
      message.textContent = data.detail || "Erreur de connexion";
      // Hide loading state on error
      loginButton.classList.remove("loading");
      btnText.style.opacity = "1";
      btnSpinner.classList.add("hidden");
    }
  } catch (error) {
    message.textContent = "Erreur serveur, r√©essayez plus tard.";
    // Hide loading state on error
    loginButton.classList.remove("loading");
    btnText.style.opacity = "1";
    btnSpinner.classList.add("hidden");
  }
}

function initializeLoginPage() {
  // V√©rifier s'il y a des donn√©es sauvegard√©es au chargement de la page
  const savedCredentials = localStorage.getItem('qwotaCredentials');
  if (savedCredentials) {
    try {
      const { username, password, rememberMe } = JSON.parse(savedCredentials);
      if (rememberMe) {
        document.getElementById('username').value = username;
        document.getElementById('password').value = password;
        document.getElementById('rememberMe').checked = true;

        console.log('[AUTO-LOGIN] Connexion automatique d√©tect√©e pour:', username);

        // Connexion automatique si "Se souvenir de moi" √©tait coch√©
        setTimeout(() => {
          performLogin(username, password, rememberMe);
        }, 500);
      }
    } catch (error) {
      // Erreur lors du chargement des donn√©es sauvegard√©es
      console.error('[AUTO-LOGIN] Erreur:', error);
      localStorage.removeItem('qwotaCredentials');
    }
  }

  // Gestion du formulaire de connexion
  document.getElementById("loginForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value;
    const rememberMe = document.getElementById("rememberMe").checked;

    // Utiliser la fonction r√©utilisable
    await performLogin(username, password, rememberMe);
  });

  // Smooth animations for form inputs
  document.querySelectorAll('.form-input').forEach(input => {
    input.addEventListener('focus', () => {
      input.parentElement.classList.add('focused');
    });

    input.addEventListener('blur', () => {
      input.parentElement.classList.remove('focused');
    });
  });
}
</script>

</body>
</html>
